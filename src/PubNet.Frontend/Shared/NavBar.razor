@inject AuthenticationService Auth

<Bar Mode="BarMode.Horizontal" Shadow="Shadow.Small" CollapseMode="BarCollapseMode.Hide" Display="Display.Flex" Flex="Flex.AlignItems.Stretch">
	<BarBrand>
		<BarItem>
			<BarLink To="/">
				<strong>PubNet</strong>
			</BarLink>
		</BarItem>
	</BarBrand>
	<BarMenu Display="Display.Flex" Flex="Flex.AlignItems.Stretch.Grow.Is1.Shrink.Is0" Shadow="Shadow.Remove">
		<BarStart Display="Display.Flex" Flex="Flex.AlignItems.Stretch.JustifyContent.Start" Margin="Margin.IsAuto.FromEnd">
			<BarItem>
				<BarLink To="/browse/packages">
					<BarIcon IconName="IconName.List" Margin="Margin.Is2.FromEnd"/>
					Packages
				</BarLink>
			</BarItem>
			<BarItem>
				<BarLink To="/browse/authors">
					<BarIcon IconName="IconName.Users" Margin="Margin.Is2.FromEnd"/>
					Authors
				</BarLink>
			</BarItem>
		</BarStart>
		<BarEnd Display="Display.Flex" Flex="Flex.AlignItems.Stretch.JustifyContent.Start">
			@switch (Authenticated)
			{
				case true:
					<BarItem>
						<BarLink To="@("/authors/" + UserName)">
							<BarIcon IconName="IconName.UserCircle" Margin="Margin.Is2.FromEnd"/>
							@UserName
						</BarLink>
					</BarItem>
					<BarItem>
						<BarLink To="/logout">
							<BarIcon IconName="IconName.Unlock" Margin="Margin.Is2.FromEnd"/>
							Logout
						</BarLink>
					</BarItem>
					break;
				case false:
					<BarItem>
						<BarLink To="/authenticate">
							<BarIcon IconName="IconName.Key" Margin="Margin.Is2.FromEnd"/>
							Authenticate
						</BarLink>
					</BarItem>
					break;
				default:
					<BarItem>
						<em>Please wait...</em>
					</BarItem>
					break;
			}
		</BarEnd>
	</BarMenu>
</Bar>

@code {

	private bool? Authenticated { get; set; }

	private string? UserName { get; set; }

	/// <inheritdoc />
	protected override async Task OnParametersSetAsync()
	{
		await base.OnParametersSetAsync();

		UserName = null;
		Authenticated = await Auth.IsAuthenticatedAsync();
		if (Authenticated == true)
			UserName = (await Auth.GetSelfAsync()).UserName;
	}

}
